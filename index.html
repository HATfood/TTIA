<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTIA.ir Push Notifications</title>
    
    <!-- This is CRUCIAL for making your site "installable" on iOS -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- A simple stylesheet to make it look nice -->
    <link rel="stylesheet" href="style.css">

    <!-- The OneSignal script you were given. "defer" is important. -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      // This makes sure the OneSignal code runs after the SDK is loaded
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        // Initialize OneSignal with your App ID
        await OneSignal.init({
          appId: "a1ca9082-d833-4630-972e-e83578a1ef79", // Your App ID
          // We set this to false so we can control WHEN to ask for permission
          // This is essential for a good user experience and for iOS.
          promptOptions: {
            autoPrompt: false, 
          },
          // This allows users to re-subscribe if they clear their cache
          autoResubscribe: true,
          // This part handles the case where a user is already subscribed on a different subdomain
          allowLocalhostAsSecureOrigin: true, // Good for local testing
        });
        
        // Run our function to update the buttons and status on page load
        updateUI(); 
      });

      // This function checks the user's status and updates the page content
      async function updateUI() {
          const permission = await OneSignal.getNotificationPermission();
          const isSubscribed = await OneSignal.isPushNotificationsEnabled();
          
          const statusDiv = document.getElementById('status');
          const subscribeButton = document.getElementById('subscribe-button');
          const unsubscribeButton = document.getElementById('unsubscribe-button');
          
          if (permission === 'denied') {
              statusDiv.textContent = "You have blocked notifications. Please enable them in your browser settings.";
              subscribeButton.style.display = 'none';
              unsubscribeButton.style.display = 'none';
          } else if (isSubscribed) {
              statusDiv.textContent = "You are subscribed to notifications!";
              subscribeButton.style.display = 'none';
              unsubscribeButton.style.display = 'inline-block';
          } else {
              statusDiv.textContent = "Click the button to subscribe.";
              subscribeButton.style.display = 'inline-block';
              unsubscribeButton.style.display = 'none';
          }
      }

      // This function is called when the user clicks the "Subscribe" button
      async function onSubscribeButtonClick() {
          // This shows OneSignal's user-friendly slidedown prompt,
          // which is better than the native browser prompt.
          await OneSignal.showSlidedownPrompt();
          // After the prompt, update the UI again
          updateUI();
      }
      
      // This function is called when the user clicks the "Unsubscribe" button
      async function onUnsubscribeButtonClick() {
          // This disables push notifications for the user
          await OneSignal.setSubscription(false);
          updateUI();
      }

    </script>
</head>
<body>

    <div class="container">
        <h1>Welcome to TTIA.ir</h1>
        <p>Get the latest updates delivered right to your screen.</p>

        <!-- Instructions specifically for iPhone/iPad users -->
        <div id="ios-instructions">
            <strong>For iPhone/iPad Users:</strong> To enable notifications, you must first add this site to your Home Screen. Tap the 'Share' icon and then 'Add to Home Screen'.
        </div>

        <div class="button-container">
            <!-- We call our functions from the button's onclick event -->
            <button id="subscribe-button" onclick="onSubscribeButtonClick()">Subscribe to Notifications</button>
            <button id="unsubscribe-button" onclick="onUnsubscribeButtonClick()" style="display: none;">Unsubscribe</button>
        </div>

        <p id="status">Loading status...</p>
    </div>

</body>
</html>
